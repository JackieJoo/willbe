# Побудова платформозалежних модулів

Використання функції визначення операційної системи для побудови платформозалежних модулів.

Зазвичай, в побудові модулів, утиліта використовує універсальні кроссплатформенні інструменти побудови модулів не прив'язуючись до конкретної операційної системи. Та, доволі часто, розробнику потрібно врахувати особливості обраної платформи. В цьому може допомогти функція визначення операційної системи.

Функція записується в вигляді `{f::os}`. Запис означає: викликати функцію `os` та підставити повернене значення. Функція повертає одне із трьох значень:  
- `windows` в операційних системах сімейства `Windows`;
- `posix` в [Unix-подібних операційних системах](<https://en.wikipedia.org/wiki/Unix-like>);
- `osx` в операційних системах сімейства `Mac OS`.

Оскільки функція `{f::os}` повертає рядкове значення, то її можна використовувати як критеріон, або ж передавати аргументом в інших викликах функцій. 

### Конфігурація

<details>
  <summary><u>Структура файлів</u></summary>

```
platformChoice
        ├── proto
        │     └── file.js
        └── .will.yml

```

</details>

Створіть структуру файлів приведену вище для побудови платформозалежного модуля.

<details>
  <summary><u>Код файла <code>Color.download.will.yml</code></u></summary>

```yaml
about :

  name : 'platformChoice'
  description : 'Building a module that depends on platform'

path :

  proto : proto
  out : out
  windows.os :
    path : '{path::out}/windows'
    criterion :
      os : 'windows'
  posix.os :
    path : '{path::out}/posix'
    criterion :
      os : 'posix'
  osx.os :
    path : '{path::out}/osx'
    criterion :
      os : 'osx'

reflector :

  copy :
    criterion :
      os : 'f::os'
    filePath :
      'path::proto' : 'path::*.os'
step :

  echo.os :
    shell : echo {f::os}

build :

  copy.on.platform :
    criterion :
      default : 1
    steps :
      - step::echo.os
      - step::copy
      
```

</details>

В створений `.will.yml` файл внесіть приведений вище код.

Збірка `copy.on.platform` виконує два кроки. В першому - `echo.os` командна оболонка виводить назву платформи побудови з допомогою функції `{f::os}`. В другому - `copy` проводиться копіювання файла з допомогою рефлектора `copy`. Для того, щоб побудова модуля була платформозалежною в якості критеріону рефлектора і згенерованого на його основі кроку використовується функція `{f::os}`. Таким чином, в залежності від того, на якій операційній системі відбудеться побудова модуля, файл `file.js` буде поміщений:
- в директорію `out/windows`;
- в директорію `out/posix`;
- в директорію `out/osx`.

### Побудова модуля  

<details>
    <summary><u>Вивід команди <code>will .build</code></u></summary>

```
[user@user ~]$ will .build
...
  Building module::platformChoice / build::copy.on.platform
 > echo posix
posix
   + copy reflected 2 files /path_to_file/ : out/posix <- proto in 0.573s
  Built module::platformChoice / build::copy.on.platform in 0.742s


```

</details>
<details>
  <summary><u>Структура модуля після побудови</u></summary>

```
platformChoice
        ├── out
        │     └── posix
        │           └── file.js
        ├── proto
        │     └── file.js
        └── .will.yml

```

</details>

Виконайте побудову модуля командою `will .build`

Приведений вивід свідчить про те, що побудова відбувалась на `posix` операційній системі, іншими словами, на Linux-дистрибутиві. Відповідно файл `file.js` знаходиться за шляхом `out/posix`.  

Ваш результат буде відрізнятись, якщо побудова буде здійснена на операційних системах `Windows` або `OS X`.

### Підсумок

- Утиліта має функцію для визначення операційної системи, в якій проводиться побудова.
- Функція повертає три рядкових значення в залежності від операційної системи: `windows`, `posix`, `osx`.
- Функція корисна при побудові платформозалежних модулів.
- Функція корисна при перенесенні данних модуля між різними платформами.

[Повернутись до змісту](../README.md#tutorials)
