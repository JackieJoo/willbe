# Створення <code>pull request</code>-ів на <code>Github</code>-i

Використання команди <code>.git.pr.open</code> для створення <code>pull request</code>-ів на <code>Github</code>-i.

### Структура локального `Git`-модуля

Для того, щоб відкрити `pull request` ( `PR` ) через командний інтерфейс утиліти, потрібно щоб директорія модуля була, одночасно, `Git`-директорією.

```
remotePullRequest
        ├── .git
        ├── ...       # module directories
        ├── ...
        ...           # module files
        │
        └── .will.yml # any module willfile
```

Умовна структура модуля приведена вище. Локальна копія `Git`-репозиторії знаходиться в директорії `remotePullRequest`. Для зручності в якості `вілфайла` використано неіменований - утиліта прочитає модуль автоматично, інакше потрібно використати команду [`.with`](./WillFileNamed.md).

### Авторизація користувача

Авторизація користувача виконується з використанням [токену доступу](https://docs.github.com/en/enterprise/2.15/user/articles/creating-a-personal-access-token-for-the-command-line).

### Ручна авторизація

Токен можна вказати безпосередньо в команді в опції `token`.

```
token:ac54066ffd52c899ccabe9bcb1291cee0a28200
```

Такий спосіб має недолік у вигляді вводу токену і відкритої форми його використання. Спрощенням цього способу є використання змінних оточення, котрі дозволяють спростити ввід та приховати вміст змінної. Експорт і використання змінної оточення в командному інтерфейсі відрізняється в різних операційних системах.

```
token:$TOKEN
```

Вище приведено приклад використання змінної оточення `TOKEN` в оточенні `UNIX`-подібних операційних систем. Ввід команди значно спрощується і вона не містить відкритих даних.

### Автоматична авторизація

Для автоматичної авторизації використовуються користувацькі конфігураційні файли :

- конфігураційний файл утиліти [`Censor`](https://github.com/Wandalen/wCensor.git);
- конфігураційний файл `.wenv.yml`.

Для використання конфігураційного файла утиліти `Censor`, встановіть її та запишіть в поле `about/github.token` значення секретного токена. Запис здійснюється командою `.config.set`.

Для використання конфігураційного файла `.wenv.yml`, створіть його в домашній директорії користувача ( директорія `$HOME` ) та запишіть в поле `about/github.token` значення токена.

```yaml
about :
  github.token : ac54066ffd52c899ccabe9bcb1291cee0a28200
```

Після запису одного з конфігураційних файлів токен буде автоматично зчитуватись.

### Де відкривається `PR`

`PR` відкривається в віддаленій репозиторії, котра визначається за одним із двох шляхів :

- через указання репозиторії в `вілфайлі` за шляхом `path/repository`;
- через зчитування шляху `origin` утиліти `Git`.

Першому способу віддається перевага, другий використовується лише за відсутності указаної репозиторії в `вілфайлі`.

### Створення `PR`-а власній репозиторії

```yaml
about :

    name : PR
    description : "Minimal willfile to open remote pull request in specified repository."

path :

  repository : git+https:///github.com/user/UserRepository.git
```

Приведений `вілфайл` містить шлях до репозиторії `UserRepository` користувача `user`. Шлях до репозиторії указується глобально ( протоколи і три слеша ). Якщо `вілфайл` не містить поля `path/repository`, то тоді утиліта намагатиметься використати шлях `origin`. Шлях `origin` можна отримати ввівши команду в директорії локальної репозиторії :

```
git remote -v
```

Приймемо, що користувач `user` є власником репозиторії. Це дозволяє користувачу `user` створювати `PR`-и між вітками репозиторії. Припустімо, що репозиторія `UserRepository` містить 2 вітки - `master` i `test`, тоді відкриття `PR`-а матиме вигляд:

```
will .git.pr.open 'Extend test routine' description:'Throwing test cases' dstBranch:master srcBranch:test
```

Приведена команда містить суб'єкт ( аргумент ) і опції:

- суб'єкт `Extend test routine` - назва `PR`-а, що буде відкрито. Існує альтернативний спосіб задання назви `PR`-а - використання опції `title`. Перевага віддається використанню суб'єкта команди;
- `description` - опція для додавання пояснення в `PR`;
- `dstBranch` - опція, котра вказує вітку в якій буде відкрито `PR`;
- `srcBranch` - опція, котра вказує з якої вітки відкрити `PR`.

Команда не включає даних про шлях до репозиторії тому, що він зчитується з `вілфайла` ( або з утиліти `Git` ).

```
will .git.pr.open 'Extend test routine' srcBranch:test
```

Мінімальна команда включає суб'єкт і `srcBranch`. При цьому `dstBranch` автоматично встановлюється в `master` і `PR` не міститиме опису.

### Створення `PR`-а з форка

Створення `PR`-а з форка в іншу репозиторію відрізняється тим, що:

- шлях в `вілфайлі` вказує на репозиторію в якій буде відкрито `PR`;
- опція `srcBranch` повинна містити нікнейм власника форка і вітку з якої буде відкрито `PR`. Нікнейм власника іншої репозиторії зчитується з шляху `origin`.

Припустімо, що користувач `user` є власником форка `UserRepository`. А власник основної репозиторії має нікнейм `owner`. Тоді для автоматичного створення `PR`-a в основній репозиторії `вілфайл` виглядатиме :

```yaml
about :

    name : PR
    description : "Minimal willfile to open remote pull request in base repository."

path :

  repository : git+https:///github.com/owner/UserRepository.git
```

Для створення `PR`-а виконується команда :

```
will .git.pr.open 'Extend test routine' srcBranch:'user:master'
```

Синтаксис `user:master` позначає, відповідно, нікнейм власника форка та вітку з якої відкрити `PR`. `PR` буде відкрито в вітці `owner:master`. Для того, щоб відкрити `PR` в іншій вітці указується опція `dstBranch` :

```
will .git.pr.open 'Extend test routine' dstBranch:test srcBranch:'user:master'
```

Указаний `PR` буде відкрито в вітці `test`.

За замовчуванням утиліта `Git` встановлює репозиторію `origin` з іменем власника форка. Тому, якщо `вілфайл` модуля не матиме поля `path/repository` утиліта намагатиметься створити `PR` в форці. Щоб швидко змінювати репозиторію призначення в `вілфайлі` можна використати команду `.willfile.extend`.

### Підсумок

- Утиліта відкриває `PR` в репозиторії, котра указана в `вілфайлі` за шляхом `path/repository`, або за посиланням `origin` утиліти `Git`.
- Нікнейм власника репозиторії визначається з шляху до віддаленої репозиторії.
- Якщо потрібно відкрити `PR` з форка в іншій репозиторії, опція `srcBranch` додатково міститиме нікнейм власника форка.
- Мінімальна команда для відкриття `PR`-а включає назву `PR`-а та вітку з якої він відкривається.

[Повернутись до змісту](../README.md#tutorials)
