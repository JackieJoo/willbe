## Ресурс крок

Ресурс секції <code>step</code>, який представляє собою інструкцію для виконання утилітою при побудові модуля. Описують операції та бажаний результат. Збірки складаються із кроків.

### Поля ресурсів секції `step`   

| Поле           | Опис                                                             |
|----------------|------------------------------------------------------------------|
| description    | описова інформація для інших розробників                         |
| criterion      | умова використання ресурса (див. [критеріон](Criterions.md))     |
| opts           | додаткові опції можуть передаватися через мапу `opts`            |
| inherit        | наслідування від інших кроків                                    |

### Вбудовані кроки  
Всі вказані приклади записані без критеріонів.  

### Вбудований крок `predefined.delete`  

Призначений для видалення файлів за вказаним шляхом. 

Включає одне поле `filePath`, в якому вказується шлях до файлів, що потрібно видалити.  

#### Приклад ресурсу з кроком `predefined.delete` 

```yaml
step:                                   # Назва секції
  delete.files:                         # Назва кроку
    inherit: predefined.delete          # Наслідування вбудованого кроку видалення файлів
    filePath: path::fileToDelete        # Файл чи директорія 'fileToDelete' в секції 'path'

```

У ресурсі `delete.files`, через [наслідування](Inheritance.md), використовується вбудований крок `predefined.delete`. Крок видаляє файли за шляхом `path::fileToDelete`.

### Вбудований крок `predefined.reflect`  

Крок призначений для виклику [рефлектора](ResourceReflector.md#Ресурс-рефлектор).  

Рефлектори виконують файлові операції над групою файлів. 

Крок включає поля `reflector` для указання ресурса секції `reflector` i поле `verbosity`, яке визначає рівень вербальності виводу консолі, тобто, кількість сервісної інформації при виконанні кроку. Діапазон зміни рівня вербальності можна задати від 0 до 8. 8 - найвищий рівень вербальності.  

#### Приклад ресурсу з кроком `predefined.reflect`

```yaml
step:                                         # Назва секції
  reflect.files:                              # Назва кроку
    inherit: predefined.reflect               # Наслідування вбудованого кроку виклика рефлектора
    reflector: reflector::reflect.some.files  # Виклик рефлектора із секції 'reflector'  
    verbosity: 3                              # Деталізація логу виконання побудови модуля (значення                                             # від 0 до 8)

```

У ресурсі `reflect.files`, через [наслідування](Inheritance.md), використовується вбудований крок `predefined.reflect`. Крок використовує рефлектор `reflect.some.files`. Рівень вербальності виводу - 3.

### Вбудований крок `predefined.js`   

Призначений для виконання JavaScript-файлів під час побудови модуля.  

Крок може використовувати лише експортовані функції і змінні в JS-файлі.  

`predefined.js` включає одне поле з назвою `js`, яке вказує шлях до JS-файла для виконання. 

Оскільки вказане поле унікальне - відсутнє в інших вбудованих кроках, то крок `predefined.js` може бути записаний через неявне наслідування, тобто, з указанням в ресурсі поля `js`.  

#### Приклади ресурсів з кроком `predefined.js`

```yaml
step:                                   # Назва секції
  run.js:                               # Назва кроку
    inherit: predefined.js              # Наслідування вбудованого кроку використання терміналу ОС
    js: path::jsFileToRun               # Шлях до JS-файла в секції 'path'

```

Запис вбудованого кроку `predefined.js` з явним указаннням наслідування в полі `inherit` ресурса `run.js`. Крок виконує файл за указаним шляхом `path::jsFileToRun`.

```yaml
step:                                   
  run.js:                           
    js: path::jsFileToRun               

```

Запис вбудованого кроку `predefined.js` в ресурсі `run.js` з неявним указаннням наслідування - поле `inherit` відсутнє. 

### Вбудований крок `predefined.shell`  

Призначений  для запуску команд в командній оболонці операційної системи.  

Розширює вбудовані можливості утиліти завдяки використанню зовнішніх програм і команд операційної системи.  

Крок `predefined.shell` має поля:
- shell - указується команда для виконання операційною системою;
- currentPath - указується шлях до директорії, в якій команда буде виконана. Якщо поле не вказано, то використовується шлях `predefined.dir`.
- forEachDst - в полі вказується назва рефлектора для указання директорії призначення для файлів, що будуть створені командою. Директорія призначення вибирається з фільтра `dst` рефлектора.
- upToDate - поле, яке встановлює можливість повторного запуску команди над файлами, що не змінились з попередньої побудови. Приймає два значення: `preserve` - не виконувати команду, якщо файли не змінились; `rebuild` - виконувати команду незалежно від змін в файлі. За замовчуванням установлено значення `preserve`. Наприклад, утиліта виконала компіляцію файлів з вихідних, якщо при повторному запуску побудови не відбулось змін в вихідних і скомпілованих файлах, то утиліта не буде виконувати команду компіляції. 

Поле `shell` присутнє тільки в вбудованому кроці `predefined.shell` і тому, крок може бути записаний через неявне наслідування, тобто, з указанням поля `shell` в ресурсі. При цьому, якщо додаткові поля не вказані, то вони приймають значення за замовчуванням.  

#### Приклади ресурсів з кроком `predefined.shell`

```yaml
step:                                   # Назва секції
  run.command:                          # Назва кроку
    inherit: predefined.shell           # Наслідування вбудованого кроку використання терміналу ОС
    shell: ls -a                        # Команда для вводу в термінал ОС
    currentPath: path::dirToRun         # Вказується директорія в якій виконується файл
    forEachDst : some_reflector         # Рефлектор для команди (необов'язково)
    upToDate : 'preserve'               # Опція - виконувати команду при зміні файлів вибірки

```
Приклад іллюструє використання явного наслідування кроку `predefined.shell` в ресурсі `run.command`. Розшифровується так: виконати команду `ls -a` в директорії за шляхом `path::dirToRun`. Для файлів призначення використати шлях в полі `dst` рефлектора `some_reflector`.   

```yaml
step:                                   
  run.command:                         
    shell: npm install
    currentPath: path::dirToRun         

```

Приклад показує неявне наслідування кроку `predefined.shell` в ресурсі `run.command`. Крок виконує команду `npm install` в директорії за шляхом `path::dirToRun`.  

### Вбудований крок `predefined.transpile` 

Об'єднання групи JavaScript-файлів в один            | reflector

```yaml
step:                                           # Назва секції
  predefined:                                   # Назва кроку
    inherit: predefined.transpile               # Наслідування вбудованого кроку об'єднання JS-файлів
    reflector: reflector::reflect.js.files      # Рефлектор для відбору JS-файлів

```

В рефлекторі необхідно вказати шляхи для файлів, які будуть скомпоновані і файл, який згенерується. Для цього в рефлекторі вказуйте відповідні фільтри. Наприклад, для поля `filePath` рефлектора:  
```yaml
  filePath :                                    # Вказується для вибору JS-файлів
    path::filesFrom : '{path::filesTo}/file.js' # Зліва - директорія з якої беруться файли,
                                                # справа - директорія в який буде згенеровано файл і його назва.

```

### Вбудований крок `predefined.export`  

Для виконання експорту модуля                        | export, tar; (export)

```yaml
step:                                   # Назва секції
  predefined:                           # Назва кроку
    inherit: predefined.export          # Наслідування вбудованого кроку експорту модуля
    export: path::fileToExport          # Шлях до файлів модуля, що експортуються
    tar: 0                              # Архівування експортованої конфігурації. '1' - ввімкнена,
                                        # '0' - вимкнена. За замовчуванням '1'

```

Вбудований крок може бути записана в скороченій формі.

```yaml
step:                                   
  predefined:                           
    export: path::fileToExport          

```

### Вбудований крок `predefined.view`  

Відображення HTML або txt сторінки в браузері        | filePath, delay  

```yaml
step:                                         # Назва секції
  predefined:                                 # Назва кроку
    inherit: predefined.view                  # Наслідування вбудованого кроку відображення HTML файла
    filePath: path::html_file                 # Шлях до HTML файла
    delay: 1000                               # Затримка запуску файла

```

##### Вбудовані кроки, що вносяться в секцію `build`  

submodules.download  | Завантаження підмодулів                              | -                               |
| submodules.upgrade   | Оновлення підмодулів                                 | -                               |
| submodules.clean     | Очищення підмодулів                                  | -                               |
| clean                | Видалення з директорії в якій знаходиться модуль 3-х типів файлів 1) завантажені підмодулі (папка `./.module`); 2) out директорія; 3) path::temp директорія, якщо вона прописана в will-файлі 

Поміщені в один сценарій збірки, але використовуються окремо:  

```yaml
build:                                  # Назва секції
  predefined:                           # Назва кроку
    steps:                              # Кроки - сценарій збірки
    - submodules.download               # Вбудовані кроки, що поміщаються в секцію `build`
    - submodules.upgrade                
    - submodules.clean
    - clean                             

```

### Секція <code>step</code>

Секція містить кроки, які можуть бути застосовані збіркою для побудови модуля. Ресурси секції - кроки - поміщають в сценарії збірок секції <code>build</code> для виконання побудови.  

#### Приклад

![step.section.png](./Images/step.section.png)

Приклад секції `step` з кроками `export.proto`, `proto.release`.
