## Ресурс крок

Інструкції по побудові модуля. Описують операції та бажаний результат. Збірка складаються із кроків.

Кроки описуються в секції `step`, але щоб вони могли бути виконані вони мають бути використані в збірці. Збірка може бути зібрана через команду `.build` і мати в якості одного із кроків даний.

### Приклад

```yml
step  :

  export.proto :
    inherit : predefined.export
    export : path::fileToExport.*
    criterion :
      debug : 0

  view :
    inherit : predefined.view
    filePath : http:///www.google.com

```

Cекції `step` містить 2-ва кроки `export.proto`, `view`. Крок `export.proto` призначений для експортування модуля. Крок `view` призначений для перегляду файлу `http:///www.google.com` користувачем на якомусь етапі збірки.

### Спільні поля кроку

| Поле           | Опис                                                             |
|----------------|------------------------------------------------------------------|
| description    | описова інформація для інших розробників                         |
| criterion      | умова використання ресурса (див. [критеріон](Criterions.md))     |
| opts           | додаткові опції можуть передаватися через мапу `opts`            |
| inherit        | наслідування від інших кроків                                    |


### Секція <code>step</code>

Секція містить кроки, які можуть бути застосовані збіркою для побудови модуля. Ресурси секції - кроки - поміщають в сценарії збірок секції <code>build</code> для виконання побудови.  

### Перелік вбудованих кроків
### Вбудований крок `predefined.delete`  

Призначений для видалення файлів за вказаним шляхом.

Включає одне поле `filePath`, в якому вказується шлях до файлів, що потрібно видалити.  

```yaml
step:                                 # Назва секції
  delete.files:                       # Назва кроку
    inherit: predefined.delete        # Наслідування
    filePath: some/dir                # Файл, який буде видалено
```

Крок `delete.files` [наслідується](Inheritance.md) від  `predefined.delete`. Цей крок видаляє файли за шляхом `path::fileToDelete`.

### Вбудований крок `predefined.reflect`  

Крок для копіювання файлів за допомогою [рефлектора](ResourceReflector.md#Ресурс-рефлектор).

Рефлектори вибирають множину файлів над якою потрібно здійснити якусь операцію. Крок `predefined.reflect` виконує копіювання файлів із одного місця в інше. За замовчуванням копіювання виконується із збереженням hard-link'ів між парою файлів. Це значить, що файл-призначення та файл-джерело матимуть один і той же зміст та будь-які зміни внесені в один із файлів відображатиметься операційною системою в іншому файлі.

Крок включає поля `reflector` для указання ресурса секції `reflector` i поле `verbosity`, яке визначає рівень вербальності виводу консолі, тобто, кількість сервісної інформації при виконанні кроку. Діапазон зміни рівня вербальності можна задати від 0 до 9. 9 - найвищий рівень вербальності.  

```yaml
step:                                         # Назва секції
  reflect.files:                              # Назва кроку
    inherit: predefined.reflect               # Наслідування
    reflector: reflector::reflect.some.files  # Рефлектор для вибірки файлів  
    verbosity: 3                              # Рівень вербальності
```

Крок `reflect.files` [наслідується](Inheritance.md) від `predefined.reflect`. Для вибору файлів крок використовує рефлектор `reflect.some.files`. Рівень вербальності виводу - 3.

### Вбудований крок `predefined.js`   

Призначений для виконання JavaScript-файлів під час побудови модуля.  

`predefined.js` має поле `js`, яке вказує шлях до `JS-файла`, що потрібно виконати.

Оскільки поле `js` має лише крок `predefined.js` - відсутнє в інших вбудованих кроках, то крок `predefined.js` може бути записаний без явного наслідування.  

```yaml
step:                                   # Назва секції
  run.js:                               # Назва кроку
    js: run.js               # Шлях до JS-файла в секції 'path'
```

Крок для виконання `run.js`. Наслідування не явне, так як поле `js` унікальне поле вбудованого кроку `predefined.js`.

### Вбудований крок `predefined.shell`  

Призначений для запуску зовнішніх програм в командній оболонці операційної системи.

Розширює вбудовані можливості утиліти завдяки використанню зовнішніх програм і команд операційної системи.  

Крок `predefined.shell` має поля:
- `shell` - команда для виконання операційною системою/
- `currentPath` - шлях до директорії, в якій команду буде виконана. Якщо поле не вказано, то використовується шлях `predefined.dir`.
- `forEachDst` - в полі вказується назва рефлектора для указання директорії призначення для файлів, що будуть створені командою. Директорія призначення вибирається з фільтра `dst` рефлектора.
- `upToDate` - поле, яке встановлює можливість повторного запуску команди над файлами, що не змінились з попередньої побудови. Приймає два значення: `preserve` - не виконувати операцію лише якщо файли не змінились; `rebuild` - виконувати команду незалежно від змін в файлі. За замовчуванням установлено значення `preserve`.

Поле `shell` присутнє тільки в вбудованому кроці `predefined.shell` і, тому, крок може бути записаний через неявне наслідування, тобто, з указанням поля `shell` в ресурсі.  

```yaml
step:                                   # Назва секції
  run.command:                          # Назва кроку
    shell: ls -a;                        # Команда для вводу в термінал ОС
```

Виклик зовнішньої програми `ls -al`. Наслідування від `predefined.shell` відбувається неявно.

### Вбудований крок `predefined.transpile`

Призначений для транспіляції `JavaScript` файлів або їх конкатенації.

Конкатенація - об'єднання групи файлів в один. Транспіляція - перетворення вихідних файлів із кодом в вихідні із аналогічним змістом, але в іншій формі. Для вибору режиму перетворення застосовується критеріони `debug` та `raw`.
- `debug : debug` утиліта виконує конкатенацію файлів без їх зміни (оптимізації)
- `debug : release` - виконується транспіляція та оптимізія коду.
- `raw : raw` утиліта не виконує конкатенацію, а кладе кожен файл окремо.
- `raw : compiled` - виконується конкатенація декількох файлів в один.

Крок `predefined.transpile` має поле `reflector` для указання рефлектора за яким буде здійснено перетворення.

```yaml
step:                                           # Назва секції
  transpile.files:                              # Назва кроку
    inherit: predefined.transpile               # Наслідування
    reflector: reflector::reflect.js.files      # Рефлектор для відбору JS-файлів
    criterion:
      debug : release
      raw : compiled
```

Крок `transpile.files` виконує транспіляцію файлів із оптимізацією `debug : release` та конкатенацією `raw : compiled`. Рефлектор `reflect.js.files` здійснює відбір файлів, які потрібно транспілювати та куди помістити результат транспіляції. Рефлектора може мати такий вигляд:  

```yaml
reflector :
  reflect.js.files :
    filePath :                                    # Мапа шляхів
      path::filesFrom : '{path::filesTo}/file.js'
```

Перемістити файли із `path::filesFrom` і покласти їх в `{path::filesTo}/file.js`.

### Вбудований крок `predefined.export`  

Призначений для виконання особливого виду побудови модуля - експорту. Результатом виконання цього кроку є згенеровані `out-will-файл` i, опціонально, архів з експортованими файлами.  

Згенерований `out-will-файл` містить повну інформацію про модуль і експортовані файли, перелік експортованих файлів, версію і т.п.  

Крок `predefined.export` має поля:
- export - Вказуються шляхи до файлів для експорту. Може вказуватися рефлектор. Унікальне поле цього кроку.
- tar - Архівування файлів модуля. Поле прийма значення: `1` - архівування включене; `0` - архівування вимкнене. За замовувчуванням значення - `1`.

Поле `export` присутнє тільки у вбудованому кроці `predefined.export` і, тому, крок може бути записаний через неявне наслідування, тобто, з указанням поля `export` в ресурсі.

```yaml
step:                                   # Назва секції
  export.files:                         # Назва кроку
    export: path::proto                       # Шлях до файлів для експортуються
    tar: 0                              # Не створювати архів
```

При виконанні побудови буде експортовано файли за шляхом `path::prot`, а створення архіву з файлами вимкнено.

### Вбудований крок `predefined.view`  

Призначений для відкриття локальних або віддалених файлів для перегляду користувачем системи.

Крок `predefined.view` використовує програми перегляду, що встановлені в операційній системі для перегляду даного типу файлів за замовчуванням. Для запуску перегляду із затримкою використовуйте поле `delay`.

Крок `predefined.view` має поля:
- поле `filePath` - вказується шлях до файлів, що потрібно відкрити;
- поле `delay` - затримка перед запуском програми для перегляду, вказується в мс.

```yaml
step:                                        # Назва секції
  open.url:                                  # Назва кроку
    inherit: predefined.view                 # Наслідування
    filePath: 'http:///google.com'            # URL-посилання
    delay: 10000                             # Затримка

```
Відкрити для перегляду сайт `http:///google.com` через 10 секунд.

### Вбудований крок `submodules.download`

Виконує завантаження файлів віддалених підмодулів указаних в ресурсах секції `submodule`.

Полів не має і може вказуватись безпосередньо в полі `steps` секції `build` без наслідування.

### Вбудований крок `submodules.update`

При наявності нових версій віддалених підмодулів завантажує і встановлює їх файли.

Полів не має і може вказуватись безпосередньо в полі `steps` секції `build` без насілдування.

### Вбудований крок `submodules.reload`

Виконує динамічне перезавантаження підмодулів. Корисний в ситуації, коли файли підмодулів, яких не було першопочатково були підвантажені в ході виконання якоїсь збірки.

Полів не має і може вказуватись безпосередньо в полі `steps` секції `build` без насілдування.

### Вбудований крок `submodules.clean`

Виконує повне видалення директорії `.module` з підмодулями.

Полів не має і може вказуватись безпосередньо в полі `steps` секції `build`.

### Вбудований крок `clean`

Виконує видалення з модуля тимчасових і згененрованих файлів. До них відносяться:
- завантажені підмодулі (директорія `.module`).
- згенеровані файли: експортовані `out-will-файл` і архів.
- `path::temp` директорія, якщо така визначена для модуля.

Полів не має і може вказуватись безпосередньо в полі `steps` секції `build`.

```yaml
build:                                  # Назва секції
  submodules.download:                  # Назва збірки
    steps:                              # Кроки - сценарій збірки
    - clean
    - submodules.download

```

Виконує повну очистку модуля та завантаження підмодулів.
